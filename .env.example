# =============================================================================
# 构音障碍语音助手 - 环境变量配置
# Dysarthria Voice Assistant - Environment Variables Configuration
# =============================================================================
#
# 使用方法：
# 1. 复制此文件为 .env: cp .env.example .env
# 2. 填写下方各项配置
# 3. 不同机器可以使用不同的 .env 配置
#
# =============================================================================

# -----------------------------------------------------------------------------
# 基础配置 (所有服务都需要)
# -----------------------------------------------------------------------------

# Redis 连接配置
# 用于任务队列、消息传递、缓存
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=                              # Redis 密码（如果有）

# PostgreSQL 数据库配置
# 用于用户数据、会话记录、转录历史等持久化存储
DATABASE_URL=postgresql://postgres:your_password@localhost:5432/dysarthria_assistant
DB_PASSWORD=your_password                    # 数据库密码

# -----------------------------------------------------------------------------
# 后端服务配置 (Backend Service)
# -----------------------------------------------------------------------------

# 服务配置
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
DEBUG=false

# JWT 认证配置
JWT_SECRET_KEY=your-super-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# MinIO 文件存储配置 (可选，用于存储音频文件)
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=audio-files
MINIO_USE_SSL=false

# -----------------------------------------------------------------------------
# Agent SDK 配置
# -----------------------------------------------------------------------------

SDK_SERVICE_NAME=agent-sdk
SDK_DEFAULT_TIMEOUT_MS=30000                 # 默认超时时间（毫秒）

# -----------------------------------------------------------------------------
# ASR Worker 配置 (语音识别)
# 部署在 GPU 机器上
# -----------------------------------------------------------------------------

# Worker 类型：sensevoice | whisper
ASR_WORKER_TYPE=sensevoice
WORKER_ID=                                   # Worker 唯一标识（留空自动生成）

# SenseVoice 模型配置
# 官方模型: https://modelscope.cn/models/iic/SenseVoiceSmall
SENSEVOICE_MODEL_PATH=/models/sensevoice     # 模型文件路径
SENSEVOICE_DEVICE=cuda:0                     # 设备：cuda:0 | cpu

# Whisper 模型配置 (备选方案)
WHISPER_MODEL_SIZE=base                      # 模型大小: tiny | base | small | medium | large
WHISPER_DEVICE=cuda:0

# GER (Grammar Error Recognition) 纠错模型
# 用于提高构音障碍语音识别准确率
GER_MODEL_PATH=/models/ger
GER_ENABLED=true

# -----------------------------------------------------------------------------
# Agent Worker 配置 (AI 对话)
# 部署在 GPU 或 CPU 机器上
# -----------------------------------------------------------------------------

# Worker 类型：qwen | openai | anthropic
AGENT_WORKER_TYPE=qwen

# 本地 LLM 配置 (Qwen)
# 模型下载: https://modelscope.cn/models/qwen/Qwen2.5-7B-Instruct
QWEN_MODEL_NAME=qwen2.5-7b-instruct
QWEN_MODEL_PATH=/models/qwen
QWEN_DEVICE=cuda:0
QWEN_MAX_TOKENS=2048

# OpenAI API 配置 (如果使用 OpenAI)
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_API_BASE=https://api.openai.com/v1   # 可自定义为代理地址
OPENAI_MODEL=gpt-4o-mini

# Anthropic API 配置 (如果使用 Claude)
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# Azure OpenAI 配置 (如果使用 Azure)
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_DEPLOYMENT_NAME=
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# -----------------------------------------------------------------------------
# TTS (文字转语音) 配置
# 用于语音主持人功能
# -----------------------------------------------------------------------------

# TTS 类型：edge_tts | azure | local
TTS_TYPE=edge_tts

# Edge TTS 配置 (免费，推荐)
EDGE_TTS_VOICE=zh-CN-XiaoxiaoNeural         # 语音角色

# Azure TTS 配置 (可选)
AZURE_SPEECH_KEY=
AZURE_SPEECH_REGION=eastasia

# 本地 TTS 配置 (如 VITS/GPT-SoVITS)
LOCAL_TTS_MODEL_PATH=/models/tts

# -----------------------------------------------------------------------------
# 前端配置 (Frontend - Next.js)
# -----------------------------------------------------------------------------

# 这些变量需要在前端项目中配置
# 创建 frontend/.env.local 文件

# NEXT_PUBLIC_API_URL=http://localhost:8000
# NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws

# -----------------------------------------------------------------------------
# 监控和日志配置 (可选)
# -----------------------------------------------------------------------------

# 日志级别: DEBUG | INFO | WARNING | ERROR
LOG_LEVEL=INFO

# Sentry 错误追踪 (可选)
SENTRY_DSN=

# Prometheus 指标 (可选)
METRICS_ENABLED=false
METRICS_PORT=9090

# -----------------------------------------------------------------------------
# 多机部署配置
# 不同机器可以有不同的配置
# -----------------------------------------------------------------------------

# 机器角色：all | backend | asr_worker | agent_worker
# - all: 单机部署所有服务
# - backend: 只运行后端服务
# - asr_worker: 只运行 ASR Worker
# - agent_worker: 只运行 Agent Worker
MACHINE_ROLE=all

# 主机器地址 (Worker 机器需要配置)
# Worker 需要知道 Redis 服务器的地址
# REDIS_URL=redis://主机器IP:6379
