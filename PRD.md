# 构音障碍无障碍语音助手 - 产品需求文档 (PRD)

## 文档信息

| 项目 | 信息 |
|------|------|
| 项目名称 | 构音障碍无障碍语音助手 (Dysarthria Voice Assistant) |
| 版本 | v1.0.0 |
| 创建日期 | 2025-12-17 |
| 目标用户 | 构音障碍人群、语言康复机构、无障碍服务提供商 |

---

## 1. 产品概述

### 1.1 产品愿景

打造一款针对构音障碍人群的无障碍语音产品，通过个性化的语音识别技术和智能 Agent，帮助用户更好地与世界沟通。

### 1.2 产品定位

- **Phase 1**: 实时语音转文字工具（对标 Whisper-flow）
- **Phase 2**: 个性化语音识别 + 智能纠错
- **Phase 3**: 语音主持人 Agent（类似语音助手，但更耐心、更理解用户）

### 1.3 核心价值

| 价值点 | 描述 |
|--------|------|
| 高准确率 | 针对构音障碍语音优化的 ASR 模型，WER 降低 30%+ |
| 个性化 | 用户可训练个人模型，系统学习用户的发音特点 |
| 低延迟 | 实时流式转录，端到端延迟 < 1秒 |
| 隐私优先 | 支持本地部署，敏感数据不上云 |
| 易用性 | PWA 跨平台，无需安装，开箱即用 |

---

## 2. 用户画像

### 2.1 主要用户群体

#### 用户A：构音障碍患者
- **背景**: 因中风、脑瘫、帕金森等疾病导致语言功能受损
- **痛点**:
  - 普通语音识别准确率极低
  - 与他人沟通困难，需要反复重复
  - 打字速度慢，影响效率
- **需求**: 能理解自己说话的语音助手

#### 用户B：康复治疗师
- **背景**: 语言康复机构的专业治疗师
- **痛点**:
  - 难以量化患者康复进度
  - 训练过程枯燥，患者参与度低
- **需求**: 辅助康复训练的工具，可追踪进度

#### 用户C：家庭照护者
- **背景**: 照顾构音障碍家人的亲属
- **痛点**:
  - 理解患者需求困难
  - 不知道如何帮助康复
- **需求**: 帮助理解患者表达的工具

### 2.2 用户场景

| 场景 | 描述 | 优先级 |
|------|------|--------|
| 日常沟通 | 用户说话，系统转为文字展示给他人 | P0 |
| 语音笔记 | 用户录制语音，系统转录并保存 | P0 |
| 语音主持 | 用户与 Agent 对话，完成任务（如查询、控制设备） | P1 |
| 康复训练 | 跟读练习，系统评估发音准确度 | P1 |
| 视频会议 | 在 Zoom/腾讯会议中实时显示字幕 | P2 |

---

## 3. 功能需求

### 3.1 功能模块总览

```
┌─────────────────────────────────────────────────────────────┐
│                        PWA 前端                              │
├─────────────┬─────────────┬─────────────┬─────────────────┤
│  实时转录    │  历史记录    │  语音主持人  │   个人中心      │
│  - 录音      │  - 会话列表  │  - 对话      │   - 个性化训练  │
│  - 实时字幕  │  - 搜索      │  - 任务执行  │   - 词汇管理    │
│  - 编辑修正  │  - 导出      │  - 多轮对话  │   - 模型设置    │
└─────────────┴─────────────┴─────────────┴─────────────────┘
```

### 3.2 核心功能详细设计

#### 3.2.1 实时语音转录 (P0)

**功能描述**: 用户按住录音按钮说话，系统实时显示转录文字。

**用户流程**:
```
用户打开应用 → 点击/按住录音按钮 → 开始说话 → 实时显示文字
→ 松开按钮 → 显示最终结果 → 可编辑修正 → 保存/分享
```

**功能要求**:

| 需求ID | 需求描述 | 优先级 | 验收标准 |
|--------|----------|--------|----------|
| F1.1 | 支持按住录音和点击切换两种模式 | P0 | 用户可选择操作方式 |
| F1.2 | 实时显示中间转录结果 | P0 | 延迟 < 500ms |
| F1.3 | 显示语音波形/音量指示 | P0 | 用户能看到自己在说话 |
| F1.4 | 支持编辑和修正转录结果 | P0 | 可点击任意文字修改 |
| F1.5 | 支持复制、分享转录结果 | P0 | 一键复制到剪贴板 |
| F1.6 | 显示置信度标记（可选） | P1 | 低置信度词汇高亮显示 |
| F1.7 | 支持离线基础转录 | P2 | 离线时使用本地小模型 |

**技术要点**:
- 使用 WebSocket 实现实时双向通信
- 前端 VAD 预处理减少无效数据传输
- 流式传输 + 增量更新 UI

#### 3.2.2 智能纠错 (P0)

**功能描述**: 系统自动识别可能的错误并提供纠正建议。

**纠错策略**:
```
ASR 输出 → 置信度检查 → 规则纠错 → LLM 纠错（可选）→ 最终结果
                ↓
         置信度 > 0.85 → 直接输出
         置信度 < 0.85 → 触发 GER 纠错
```

**功能要求**:

| 需求ID | 需求描述 | 优先级 | 验收标准 |
|--------|----------|--------|----------|
| F2.1 | 自动纠正常见误识别 | P0 | 规则库覆盖 500+ 常见错误 |
| F2.2 | 基于上下文的智能纠错 | P0 | 使用 LLM 进行语义纠错 |
| F2.3 | 支持用户自定义词汇表 | P0 | 用户添加的词汇优先识别 |
| F2.4 | 显示原始识别 vs 纠正结果 | P1 | 用户可查看原始结果 |
| F2.5 | 纠错学习（用户反馈） | P1 | 用户修正后系统学习 |

#### 3.2.3 个性化训练 (P1)

**功能描述**: 用户录制训练语料，系统微调个人模型。

**用户流程**:
```
进入训练模式 → 显示提示词 → 用户跟读录音 → 系统评估质量
→ 完成 N 条录音 → 提交训练 → 等待模型生成 → 使用个人模型
```

**功能要求**:

| 需求ID | 需求描述 | 优先级 | 验收标准 |
|--------|----------|--------|----------|
| F3.1 | 提供标准训练语料集 | P1 | 100+ 条覆盖常见音素 |
| F3.2 | 录音质量检测 | P1 | 自动检测噪音、音量等 |
| F3.3 | 训练进度展示 | P1 | 显示录制进度、预计时间 |
| F3.4 | 模型训练状态追踪 | P1 | 显示训练状态、预计完成时间 |
| F3.5 | 模型切换（通用/个人） | P1 | 用户可选择使用的模型 |
| F3.6 | 增量训练 | P2 | 追加数据继续优化模型 |

#### 3.2.4 语音主持人 Agent (P1)

**功能描述**: 智能语音助手，理解用户意图并执行任务。

**Agent 特点**:
- 更耐心：不会因为听不清就放弃
- 更智能：结合上下文理解模糊表达
- 更友好：给予用户鼓励和正向反馈

**对话示例**:
```
用户: "我...我想...呃...查一下...明天...天气"
Agent: "好的，您想查明天的天气对吗？请问是哪个城市？"
用户: "北...北京"
Agent: "明天北京天气晴，最高温度8度，最低温度-2度。您还想了解其他信息吗？"
```

**功能要求**:

| 需求ID | 需求描述 | 优先级 | 验收标准 |
|--------|----------|--------|----------|
| F4.1 | 语音对话（说→听→说） | P1 | 端到端延迟 < 2秒 |
| F4.2 | 多轮对话上下文保持 | P1 | 支持 10 轮以上对话 |
| F4.3 | 常用任务支持（天气、时间、提醒） | P1 | 覆盖 10+ 常用场景 |
| F4.4 | 澄清确认机制 | P1 | 不确定时主动询问确认 |
| F4.5 | 个性化问候和反馈 | P1 | 根据用户习惯调整 |
| F4.6 | 可打断（barge-in） | P2 | 用户说话时 Agent 停止 |
| F4.7 | 情感识别和响应 | P2 | 识别用户情绪并调整语气 |

#### 3.2.5 历史记录管理 (P0)

**功能要求**:

| 需求ID | 需求描述 | 优先级 | 验收标准 |
|--------|----------|--------|----------|
| F5.1 | 会话列表展示 | P0 | 按时间倒序排列 |
| F5.2 | 全文搜索 | P0 | 支持关键词搜索 |
| F5.3 | 会话详情查看 | P0 | 显示完整转录文本 |
| F5.4 | 编辑和删除 | P0 | 支持修改和删除会话 |
| F5.5 | 导出功能 | P1 | 支持 TXT/PDF 导出 |
| F5.6 | 音频回放 | P1 | 可回放原始录音 |
| F5.7 | 标签和分类 | P2 | 用户可添加标签 |

---

## 4. 非功能需求

### 4.1 性能需求

| 指标 | 要求 | 说明 |
|------|------|------|
| ASR 延迟 | < 500ms | 从说话结束到文字显示 |
| Agent 响应延迟 | < 2s | 从用户说完到 Agent 开始回复 |
| 首屏加载 | < 3s | PWA 首次加载时间 |
| 音频上传带宽 | < 32kbps | 16kHz 16bit mono |
| 并发用户数 | 1000+ | 单实例支持 |

### 4.2 可用性需求

| 指标 | 要求 |
|------|------|
| 系统可用性 | 99.9% |
| 数据持久性 | 99.99% |
| 故障恢复时间 | < 5分钟 |

### 4.3 安全需求

| 需求 | 描述 |
|------|------|
| 数据加密 | 传输使用 TLS 1.3，存储使用 AES-256 |
| 认证授权 | JWT + OAuth2.0 |
| 隐私合规 | 符合 GDPR、个人信息保护法 |
| 音频数据 | 用户可选择不保存原始音频 |

### 4.4 兼容性需求

| 平台 | 浏览器要求 |
|------|----------|
| Desktop | Chrome 90+, Edge 90+, Safari 15+, Firefox 90+ |
| Mobile | iOS Safari 15+, Android Chrome 90+ |
| PWA 功能 | Service Worker, Web Audio API, MediaRecorder |

---

## 5. 系统架构

### 5.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              客户端层                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      PWA (Next.js 14)                            │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐   │   │
│  │  │ 实时转录  │ │ 历史记录  │ │ 语音主持  │ │     设置中心      │   │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────────────┘   │   │
│  │                    ↓ WebSocket / HTTP                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────┬─────────────────────────────────────────┘
                                │
┌───────────────────────────────┴─────────────────────────────────────────┐
│                            网关层                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    API Gateway (Kong/Traefik)                    │   │
│  │         认证 │ 限流 │ 路由 │ 负载均衡 │ 监控                      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────┬─────────────────────────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
┌───────┴───────┐     ┌─────────┴─────────┐    ┌───────┴───────┐
│   业务服务     │     │     AI 服务       │    │  Agent 服务   │
│  (biz-api)    │     │   (ai-service)    │    │ (agent-svc)   │
│               │     │                   │    │               │
│ - 用户管理    │     │ - ASR 推理        │    │ - 对话管理    │
│ - 会话管理    │     │ - GER 纠错        │    │ - TTS 合成    │
│ - 配置管理    │     │ - 模型管理        │    │ - 意图识别    │
│ - 数据存储    │     │ - 训练任务        │    │ - 任务执行    │
│               │     │                   │    │               │
│ FastAPI       │     │ FastAPI + GPU     │    │ Pipecat       │
└───────┬───────┘     └─────────┬─────────┘    └───────┬───────┘
        │                       │                       │
        └───────────────────────┼───────────────────────┘
                                │
┌───────────────────────────────┴─────────────────────────────────────────┐
│                            数据层                                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌────────────┐  │
│  │  PostgreSQL  │  │    Redis     │  │    MinIO     │  │ 模型存储    │  │
│  │  (用户/会话) │  │  (缓存/队列) │  │  (音频文件)  │  │ (S3/本地)  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  └────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 服务划分

| 服务 | 职责 | 技术栈 | 部署要求 |
|------|------|--------|----------|
| **biz-api** | 业务逻辑、用户管理、数据存储 | FastAPI + SQLAlchemy | CPU, 2核4G |
| **ai-service** | ASR 推理、GER 纠错、模型训练 | FastAPI + PyTorch | GPU, T4/A10 |
| **agent-service** | 语音 Agent、对话管理、TTS | Pipecat + LangChain | CPU, 4核8G |

### 5.3 服务间通信

```
┌─────────────┐     HTTP/REST      ┌─────────────┐
│   biz-api   │ ←───────────────→  │    PWA      │
└──────┬──────┘                    └─────────────┘
       │                                  ↑
       │ gRPC (内部)                      │ WebSocket
       │                                  │
┌──────┴──────┐                    ┌──────┴──────┐
│ ai-service  │ ←───────────────→  │ agent-svc   │
└─────────────┘     gRPC           └─────────────┘
```

---

## 6. 数据模型

### 6.1 核心实体

```
┌─────────────────┐       ┌─────────────────┐
│      User       │       │    Session      │
├─────────────────┤       ├─────────────────┤
│ id              │──┐    │ id              │
│ email           │  │    │ user_id         │──┐
│ name            │  │    │ title           │  │
│ created_at      │  │    │ created_at      │  │
│ settings (JSON) │  │    │ updated_at      │  │
└─────────────────┘  │    │ metadata (JSON) │  │
                     │    └─────────────────┘  │
                     │           │             │
                     │           │ 1:N         │
                     │           ↓             │
                     │    ┌─────────────────┐  │
                     │    │   Transcript    │  │
                     │    ├─────────────────┤  │
                     │    │ id              │  │
                     │    │ session_id      │──┘
                     │    │ text            │
                     │    │ original_text   │
                     │    │ confidence      │
                     │    │ audio_url       │
                     │    │ start_time      │
                     │    │ end_time        │
                     │    │ created_at      │
                     │    └─────────────────┘
                     │
                     │    ┌─────────────────┐
                     │    │  UserVocabulary │
                     │    ├─────────────────┤
                     └───→│ id              │
                          │ user_id         │
                          │ word            │
                          │ frequency       │
                          │ created_at      │
                          └─────────────────┘
```

### 6.2 数据字典

详见 `docs/data-dictionary.md`

---

## 7. API 设计

### 7.1 RESTful API 概览

| 模块 | 端点 | 方法 | 描述 |
|------|------|------|------|
| 认证 | `/api/v1/auth/login` | POST | 用户登录 |
| 认证 | `/api/v1/auth/register` | POST | 用户注册 |
| 用户 | `/api/v1/users/me` | GET | 获取当前用户信息 |
| 用户 | `/api/v1/users/me/settings` | PATCH | 更新用户设置 |
| 会话 | `/api/v1/sessions` | GET | 获取会话列表 |
| 会话 | `/api/v1/sessions/{id}` | GET | 获取会话详情 |
| 会话 | `/api/v1/sessions` | POST | 创建新会话 |
| 会话 | `/api/v1/sessions/{id}` | DELETE | 删除会话 |
| 转录 | `/api/v1/transcribe/batch` | POST | 批量转录音频 |
| 词汇 | `/api/v1/vocabulary` | GET/POST/DELETE | 词汇表管理 |
| 训练 | `/api/v1/training/tasks` | POST | 创建训练任务 |
| 训练 | `/api/v1/training/tasks/{id}` | GET | 查询训练状态 |

### 7.2 WebSocket API

| 端点 | 描述 |
|------|------|
| `/ws/transcribe` | 实时转录流 |
| `/ws/agent` | 语音 Agent 对话 |

### 7.3 API 详细设计

详见 `docs/api-specification.md`

---

## 8. 用户界面设计

### 8.1 页面结构

```
/                     # 首页/实时转录
/history              # 历史记录
/history/:id          # 会话详情
/assistant            # 语音主持人
/training             # 个性化训练
/training/record      # 录制训练语料
/settings             # 设置
/settings/vocabulary  # 词汇管理
/settings/model       # 模型设置
```

### 8.2 核心页面原型

#### 8.2.1 实时转录页面

```
┌────────────────────────────────────────┐
│  ☰  无障碍语音助手           ⚙️  👤   │
├────────────────────────────────────────┤
│                                        │
│  ┌──────────────────────────────────┐  │
│  │                                  │  │
│  │     实时转录文字显示区域          │  │
│  │                                  │  │
│  │  "今天天气很好，我想出去..."     │  │
│  │                                  │  │
│  │                                  │  │
│  └──────────────────────────────────┘  │
│                                        │
│           ~~~~~ 音量波形 ~~~~~          │
│                                        │
│              ┌─────────┐               │
│              │   🎤    │               │
│              │  按住说话 │               │
│              └─────────┘               │
│                                        │
│     📋 复制    📤 分享    💾 保存      │
│                                        │
└────────────────────────────────────────┘
```

#### 8.2.2 语音主持人页面

```
┌────────────────────────────────────────┐
│  ←  语音主持人                    ⚙️   │
├────────────────────────────────────────┤
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  🤖 您好！有什么可以帮您的吗？    │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  👤 我想查一下明天的天气          │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  🤖 好的，请问是哪个城市呢？      │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  👤 北京                          │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │  🤖 明天北京天气晴，8/-2度        │  │
│  │     建议穿厚外套出门。            │  │
│  └──────────────────────────────────┘  │
│                                        │
│              ┌─────────┐               │
│              │   🎤    │               │
│              │  说点什么 │              │
│              └─────────┘               │
│                                        │
└────────────────────────────────────────┘
```

---

## 9. 开发计划

### 9.1 里程碑

| 阶段 | 时间 | 交付物 |
|------|------|--------|
| **M1: MVP** | 第1-6周 | 基础转录功能、PWA 框架 |
| **M2: 智能化** | 第7-12周 | GER 纠错、个性化训练 |
| **M3: Agent** | 第13-18周 | 语音主持人、多轮对话 |
| **M4: 优化** | 第19-22周 | 性能优化、生产部署 |

### 9.2 M1 详细任务

| 周次 | 任务 | 产出 |
|------|------|------|
| W1 | 项目初始化、架构搭建 | 项目骨架、CI/CD |
| W2 | PWA 框架开发 | 基础页面、路由 |
| W3 | 音频采集模块 | 录音功能、VAD |
| W4 | 后端 API 开发 | 认证、会话管理 |
| W5 | AI 服务开发 | ASR 集成、流式转录 |
| W6 | 集成测试、Bug修复 | MVP 可用版本 |

---

## 10. 风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| ASR 准确率不足 | 中 | 高 | 引入 GER 纠错、个性化训练 |
| 延迟过高 | 中 | 高 | 边缘部署、模型量化 |
| GPU 成本过高 | 高 | 中 | 按需扩缩容、Spot 实例 |
| 用户隐私顾虑 | 中 | 高 | 支持本地部署、数据加密 |
| 浏览器兼容性 | 低 | 中 | 渐进增强、Polyfill |

---

## 11. 成功指标

### 11.1 产品指标

| 指标 | M1 目标 | M3 目标 |
|------|---------|---------|
| 日活用户 (DAU) | 100 | 1,000 |
| 次日留存率 | 30% | 50% |
| 平均会话时长 | 5分钟 | 10分钟 |
| 用户满意度 (NPS) | - | 40+ |

### 11.2 技术指标

| 指标 | M1 目标 | M3 目标 |
|------|---------|---------|
| ASR WER (构音障碍) | 35% | 20% |
| 端到端延迟 | < 1s | < 500ms |
| 系统可用性 | 99% | 99.9% |
| API P99 延迟 | < 500ms | < 200ms |

---

## 附录

### A. 术语表

| 术语 | 解释 |
|------|------|
| ASR | Automatic Speech Recognition，自动语音识别 |
| GER | Generative Error Correction，生成式错误纠正 |
| VAD | Voice Activity Detection，语音活动检测 |
| TTS | Text-to-Speech，文字转语音 |
| WER | Word Error Rate，词错误率 |
| PWA | Progressive Web App，渐进式 Web 应用 |
| LoRA | Low-Rank Adaptation，低秩适应微调 |

### B. 参考文档

- [Whisper-flow](https://github.com/dimastatz/whisper-flow)
- [Pipecat](https://github.com/pipecat-ai/pipecat)
- [TEN Framework](https://github.com/TEN-framework/ten-framework)
- [SenseVoice](https://github.com/FunAudioLLM/SenseVoice)
- [Web Speech API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API)
